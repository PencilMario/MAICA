name: Package Application with Pyinstaller

on: push

jobs:
  MAICA-main-exe:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3

      - name: Create Executable for MAICA
        uses: theSanguss/pyinstaller-action@patch-1
        with:
          python_ver: '3.12'
          spec: 'maica/maica_starter.py'
          requirements: 'requirements.txt'
          upload_exe_with_name: 'MAICA'
          options: --onefile, --name "maica_starter",

  local-account-adder:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3

      - name: Create Executable for Register
        uses: theSanguss/pyinstaller-action@patch-1
        with:
          python_ver: '3.11'
          spec: 'maica/create_account.py'
          requirements: 'requirements_2.txt'
          upload_exe_with_name: 'Register'
          options: --onefile, --name "Register",

  release:
    needs: [MAICA-main-exe, local-account-adder]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Download MAICA Executable
        uses: actions/download-artifact@v3
        with:
          name: MAICA
          path: dist/

      - name: Download Register Executable
        uses: actions/download-artifact@v3
        with:
          name: Register
          path: dist/

      - name: Copy env_example
        run: cp maica/env_example dist/

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/maica_starter.exe
            dist/Register.exe
            dist/env_example
